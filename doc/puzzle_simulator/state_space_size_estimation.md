# Calculating the state space size of twisty puzzles

We define puzzles as sets of colored 3D points and basic moves acting on these as permutations.

This representation defines a permutation subgroup generated by the basic moves. Existing tools like sympy can calculate the order of this group (likely using the Schreier-Sims algorithm).

However, this can overestimate the number of actual states when there are several indistinguishable pieces on a puzzle. For example the four center pieces on a 4x4x4 cube (Rubik's Revenge) are indistinguishable. The group order is an upper bound on the number of states though.

Using the piece detection algorithm described in a previous section, we can try to correct for this by grouping the points into physical pieces and grouping those into equivalence classes. Assuming all permutations of identical pieces are possible (which isn't always true), we can then get a lower bound on the number of states by dividing the upper bound by the number of permutations of indistinguishable pieces.

**Example:**
The 4x4x4 cube has 4 indistinguishable center pieces on each of the 6 faces and out of the 24 edge pieces, only 12 look different, each apperaing twice. Given $k$ indistinguishable pieces, there are at most $k!$ possible permutations of them.

Given an upper estimate for the group order *u*, we can calculate the lower bound *l* as follows:
$$l = u / ((4!)^6 * 2^{12})$$

